#include "esp_common.h"
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"

#include "i2c_master.h"

#include "oled.h"

#include "5x8_vertikal_LSB_1.h"


void oled_write_command(unsigned char command)
{
	unsigned char ack = 0;


	i2c_master_start();

	i2c_master_writeByte(SSD1306_address << 1);

	ack = i2c_master_checkAck();

	i2c_master_writeByte(0x00);

	ack = i2c_master_checkAck();

	i2c_master_writeByte(command);

	ack = i2c_master_checkAck();

	i2c_master_stop();
}

void oled_write_data(unsigned char data)
{
	unsigned char ack = 0;


	i2c_master_start();

	i2c_master_writeByte(SSD1306_address << 1);

	ack = i2c_master_checkAck();

	i2c_master_writeByte(0x40);

	ack = i2c_master_checkAck();

	i2c_master_writeByte(data);

	ack = i2c_master_checkAck();

	i2c_master_stop();
}

void oled_init(void) {
	// OFF
	oled_write_command(SSD1306_DISPLAYOFF);                    // 0xAE

	// Set MUX Ratio
	oled_write_command(SSD1306_SETMULTIPLEX);                  // 0xA8
	oled_write_command(0x3F);

	// Set Display Offset
	oled_write_command(SSD1306_SETDISPLAYOFFSET);              // 0xD3
	oled_write_command(0x0);                                   // no offset

	// Set Display Start Line
	oled_write_command(SSD1306_SETSTARTLINE | 0x0);            // line #0

	// Set Memory Addressing Mode
	oled_write_command(SSD1306_MEMORYMODE);                    // 0x20
	oled_write_command(0x01);                                  // 0x0 act like ks0108

	// Set Segment  re-map
	oled_write_command(SSD1306_SEGREMAP | 0x1);

	// Set COM Output Scan Direction
	oled_write_command(SSD1306_COMSCANDEC);

	// Set COM Pins hardware configuration
	oled_write_command(SSD1306_SETCOMPINS);                    // 0xDA
	oled_write_command(0x12);

	// Set Contrast Control
	oled_write_command(SSD1306_SETCONTRAST);                   // 0x81
	oled_write_command(0xF0);

	// Disable Entire Display On
	oled_write_command(SSD1306_DISPLAYALLON_RESUME);           // 0xA4

	// Set Normal Display
	oled_write_command(SSD1306_NORMALDISPLAY);                 // 0xA6

	// Set Osc Frequency
	oled_write_command(SSD1306_SETDISPLAYCLOCKDIV);            // 0xD5
	oled_write_command(0x80);

	oled_write_command(SSD1306_SETPRECHARGE);                  // 0xd9
	oled_write_command(0xF1);
	oled_write_command(SSD1306_SETVCOMDETECT);                 // 0xDB
	oled_write_command(0x40);

	// Enable charge pump regulator
	oled_write_command(SSD1306_CHARGEPUMP);                    // 0x8D
	oled_write_command(0x14);								  // Enable Charge Pump

	// Display On
	oled_write_command(SSD1306_DISPLAYON);

	// Set column range
	oled_write_command(SSD1306_COLUMNADDR);
	oled_write_command(0);   // Column start address (0 = reset)
	oled_write_command(SSD1306_LCDWIDTH - 1); // Column end address (127 = reset)

	// Set page range
	oled_write_command(SSD1306_PAGEADDR);
	oled_write_command(0); // Page start address (0 = reset)

	oled_write_command(7); // Page end address



}

void oled_write_char(uint8_t x, uint8_t y, unsigned char character) {
	unsigned char ack = 0;

	oled_write_command(0xB0 | y);

	oled_write_command(((x & 0xF0) >> 4) | 0x10);
	oled_write_command(x & 0x0F);

	i2c_master_start();

	i2c_master_writeByte(SSD1306_address << 1);

	ack = i2c_master_checkAck();

	i2c_master_writeByte(0x40);

	ack = i2c_master_checkAck();

	uint8_t i;
	for(i = 0; i <= 5; i++) {
		i2c_master_writeByte(font[character][i]);

		ack = i2c_master_checkAck();
	}

	i2c_master_stop();
}

void oled_write_string(uint8_t x, uint8_t y, char *string) {
	while(*string) {
		oled_write_char(x, y, *string);
		string++;
		x += 5;
	}
}

void oled_x_y(uint8_t x, uint8_t y) {
		// Set column (x) address
		oled_write_command(0x00 | (x & 0x0F));
		oled_write_command(0x10 | ((x & 0xF0) >> 4));

		// Set page (y) address
		oled_write_command(0xB0 | y);
}

void oled_noise_generator() {
	int i, j, ack;

	for(j = 0; j <= 8; j++) {
		oled_write_command(0xB0 | j);

		i2c_master_start();
		i2c_master_writeByte(SSD1306_address << 1);
		ack = i2c_master_checkAck();
		i2c_master_writeByte(0x40);
		ack = i2c_master_checkAck();

		for(i = 0; i <= 128/4; i++) {
			unsigned long myrand = os_random();
			i2c_master_writeByte(myrand & 0xFF);
      ack = i2c_master_checkAck();
			i2c_master_writeByte((myrand & 0xFF00) >> 8);
      ack = i2c_master_checkAck();
			i2c_master_writeByte((myrand & 0xFF0000) >> 16);
      ack = i2c_master_checkAck();
			i2c_master_writeByte((myrand & 0xFF000000) >> 24);
			ack = i2c_master_checkAck();
		}
		i2c_master_stop();
	}
}

uint8_t myBuffer[64][16];
uint8_t cloud[64][16] =
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x7f,0xff,0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x01,0xff,0xff,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x03,0xff,0xff,0xfe,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x0f,0xfc,0x01,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x1f,0xe0,0x00,0x3f,0x80,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x3f,0x80,0x00,0x0f,0xc0,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x7e,0x00,0x00,0x07,0xe0,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0xfc,0x00,0x00,0x03,0xf0,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0xf8,0x00,0x00,0x01,0xf8,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x01,0xf0,0x00,0x00,0x00,0xf8,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x03,0xe0,0x00,0x00,0x00,0x7c,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x03,0xe0,0x00,0x00,0x00,0x3c,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x03,0xc0,0x00,0x00,0x00,0x3e,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x07,0xc0,0x00,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x07,0x80,0x00,0x00,0x00,0x1f,0x7f,0xf8,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x07,0x80,0x00,0x00,0x00,0x1f,0xff,0xff,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x0f,0x80,0x00,0x00,0x00,0x0f,0xff,0xff,0xc0,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x0f,0xff,0xff,0xe0,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x0f,0xe0,0x1f,0xf0,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x0f,0x00,0x03,0xfc,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0xfe,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3f,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x7f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1f,0x00,0x00,0x00
,0x00,0x00,0x00,0x07,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0x80,0x00,0x00
,0x00,0x00,0x00,0x1f,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xc0,0x00,0x00
,0x00,0x00,0x00,0x3f,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xc0,0x00,0x00
,0x00,0x00,0x00,0xff,0xe7,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xe0,0x00,0x00
,0x00,0x00,0x01,0xfe,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xe0,0x00,0x00
,0x00,0x00,0x01,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xe0,0x00,0x00
,0x00,0x00,0x03,0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xf0,0x00,0x00
,0x00,0x00,0x07,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00
,0x00,0x00,0x07,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00
,0x00,0x00,0x0f,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00
,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00
,0x00,0x00,0x1f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00
,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00
,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00
,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00
,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00
,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf0,0x00,0x00
,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xf0,0x00,0x00
,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xe0,0x00,0x00
,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xe0,0x00,0x00
,0x00,0x00,0x1e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xe0,0x00,0x00
,0x00,0x00,0x1f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xc0,0x00,0x00
,0x00,0x00,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xc0,0x00,0x00
,0x00,0x00,0x0f,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0x80,0x00,0x00
,0x00,0x00,0x07,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1f,0x00,0x00,0x00
,0x00,0x00,0x07,0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3f,0x00,0x00,0x00
,0x00,0x00,0x03,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xfe,0x00,0x00,0x00
,0x00,0x00,0x01,0xf8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xfc,0x00,0x00,0x00
,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0f,0xf8,0x00,0x00,0x00
,0x00,0x00,0x00,0x7f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xe0,0x00,0x00,0x00
,0x00,0x00,0x00,0x3f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xc0,0x00,0x00,0x00
,0x00,0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x03,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf8,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

uint8_t chip[64][16] =
{
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x07,0xf8,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x31,0x0c,0x1c,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x9b,0xb9,0x06,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xcf,0xf3,0x03,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xee,0x66,0x41,0x80,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x7c,0x3c,0xc0,0xc0,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x38,0x1d,0x80,0x60,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x19,0xf0,0x0f,0x30,0x30,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0xe0,0x07,0x30,0x18,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x47,0xc0,0x03,0xe6,0x0c,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x63,0x80,0x01,0xcc,0x06,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x01,0x37,0x00,0x00,0xf9,0x83,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x01,0x9e,0x00,0x00,0x73,0x01,0x86,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x0c,0xdc,0x00,0x00,0x3e,0x60,0xcf,0x80,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x06,0x78,0x00,0x00,0x1c,0xe0,0x79,0x80,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x33,0x70,0x00,0x00,0x0c,0xc8,0x3d,0x80,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x31,0xe0,0x00,0x00,0x07,0x98,0x0f,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x99,0xc0,0x00,0x00,0x03,0x32,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0xcf,0x80,0x00,0x00,0x01,0xe6,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x67,0x00,0x00,0x00,0x00,0xec,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x03,0x3e,0x00,0x00,0x00,0x00,0x78,0xc0,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x01,0x9c,0x00,0x00,0x00,0x00,0x39,0x9f,0xc0,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x08,0xf8,0x00,0x00,0x00,0x00,0x1f,0x3f,0xe0,0x00,0x00,0x00},
{0x00,0x00,0x40,0x00,0x0c,0x70,0x00,0x00,0x00,0x00,0x0e,0x60,0x30,0x00,0x00,0x00},
{0x00,0x00,0xf0,0x00,0x07,0xe0,0x00,0x00,0x00,0x00,0x07,0xc0,0x18,0x00,0x00,0x00},
{0x00,0x01,0x9e,0x00,0x03,0xc0,0x00,0x00,0x00,0x00,0x03,0x80,0x0c,0x00,0x00,0x00},
{0x00,0x01,0x9f,0x00,0x03,0x80,0x00,0x00,0x00,0x00,0x01,0x80,0x06,0x00,0x00,0x00},
{0x00,0x00,0xf1,0x80,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0xe0,0x03,0x06,0x00,0x00},
{0x00,0x00,0x40,0xc0,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0xe0,0x01,0x9f,0x00,0x00},
{0x00,0x00,0x00,0x60,0x03,0x80,0x00,0x00,0x00,0x00,0x01,0xc0,0x00,0xf9,0x00,0x00},
{0x00,0x00,0x00,0x30,0x03,0xc0,0x00,0x00,0x00,0x00,0x03,0x80,0x00,0x79,0x00,0x00},
{0x00,0x00,0x00,0x18,0x07,0xe0,0x00,0x00,0x00,0x00,0x07,0xc0,0x00,0x1f,0x00,0x00},
{0x00,0x00,0x00,0x0c,0x0c,0x70,0x00,0x00,0x00,0x00,0x0e,0x60,0x00,0x04,0x00,0x00},
{0x00,0x00,0x00,0x06,0x08,0xf8,0x00,0x00,0x00,0x00,0x1f,0x30,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x03,0x01,0x9c,0x00,0x00,0x00,0x00,0x39,0x80,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x01,0x83,0x3e,0x00,0x00,0x00,0x00,0x78,0xc0,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0xc2,0x67,0x00,0x00,0x00,0x00,0xec,0x80,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x60,0xcf,0x80,0x00,0x00,0x01,0xe6,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x30,0x19,0xc0,0x00,0x00,0x03,0x32,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x18,0x31,0xe0,0x00,0x00,0x07,0x98,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x0f,0xf3,0x70,0x00,0x00,0x0e,0xc8,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x06,0x78,0x00,0x00,0x1c,0x60,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x0c,0xdc,0x00,0x00,0x36,0x20,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x01,0x9e,0x00,0x00,0x73,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x01,0x1f,0x00,0x00,0xf9,0x80,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x03,0x80,0x73,0x80,0x01,0xcc,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x07,0xc0,0x67,0xc0,0x03,0xe6,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x04,0x78,0x0c,0xe0,0x07,0x70,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x06,0xfc,0x19,0xf0,0x0f,0x30,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x03,0x86,0x03,0x38,0x19,0x80,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x03,0x06,0x3c,0x3c,0xc0,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x01,0x84,0x6e,0x66,0x40,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0xc1,0xcf,0xe3,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x61,0x9b,0xb9,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x31,0x98,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x1f,0xe0,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
};

void oled_clear_buffer() {
  int x, y;

  for(y = 0; y <= 7; y++) {
  oled_x_y(0, y);
    for(x = 0; x <= (8*128)-1; x++) {
      oled_write_data(0x00);
    }
  }
}

void oled_write_buffer(uint8_t (*array)[16]) {
  uint8_t x, y, page_p_pos = 0, column_p_pos = 0, page = 0, page_buf = 0;

	oled_x_y(0, 0);

  for(x = 0; x <= 127; x++) {
    for(y = 0; y <= 63; y++) {
      if(array[y][x/8] & (0x80 >> column_p_pos)) {
      //printf("Buffer, x: %d, y: %d, value: %x, column_p_pos: %d\n", x, y, myBuffer[x/8][y], column_p_pos);
      page_buf |= (0x01 << page_p_pos);
    }

    page_p_pos++;
    if(page_p_pos == 8) {
      page_p_pos = 0;

			#ifndef SSH1106
			oled_x_y(x, (y/8));
			#endif

      oled_write_data(page_buf);
      page_buf = 0;
      }
    }

    column_p_pos++;
    if(column_p_pos == 8) {
      column_p_pos = 0;
    }
  }
}

LOCAL void oled_task(void *pvParameters)
{
	i2c_master_gpio_init();
	i2c_master_init();

	system_update_cpu_freq(160);

	oled_init();

  uint8_t myThing = 0;

	oled_clear_buffer();

	while (1) {
		//oled_noise_generator();

    oled_write_buffer(cloud);

    vTaskDelay(5000 / portTICK_RATE_MS);

    oled_write_buffer(chip);

		vTaskDelay(5000 / portTICK_RATE_MS);
	}

	vTaskDelete(NULL);
	printf("delete the json_task\n");
}

void oled_start(void)
{
	xTaskCreate(oled_task, "oled_task", 1024, NULL, 4, NULL);
}

/* end-of-file-found */
